<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>my-auto-site</title>

  <style>
    :root{
      --bg:#0b0f1a;
      --card:rgba(255,255,255,.06);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --border:rgba(255,255,255,.12);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 400px at 10% 0%, rgba(99,102,241,.35), transparent 60%),
        radial-gradient(900px 400px at 90% 10%, rgba(16,185,129,.25), transparent 60%),
        var(--bg);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:28px 18px 60px}
    header{
      padding:28px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:var(--card);
    }
    h1{margin:10px 0;font-size:32px}
    .sub{color:var(--muted)}
    .grid{
      display:grid;
      grid-template-columns:1.4fr .9fr;
      gap:16px;
      margin-top:16px;
    }
    @media(max-width:900px){.grid{grid-template-columns:1fr}}

    .card{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:var(--card);
      overflow:hidden;
    }
    .hd{
      padding:14px 18px;
      border-bottom:1px solid var(--border);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .bd{padding:18px}
    .k{color:var(--muted);font-size:13px}
    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      font-size:12px;
      color:var(--muted);
    }
    .btn{
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
    }
    .btn:hover{background:rgba(255,255,255,.1)}
    .table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    .table th,.table td{
      padding:8px;
      border-bottom:1px solid var(--border);
    }
    .right{text-align:right}
    .muted{color:var(--muted)}
    .newsItem{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      margin-bottom:10px;
    }
    input{
      flex:1;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.25);
      color:var(--text);
    }
  </style>
</head>

<body>
<div class="wrap">

<header>
  <h1>ğŸ“ˆ my-auto-site</h1>
  <p class="sub">GitHub Pages + Actionsë¡œ ë§Œë“  ì¦ì‹œ ê°€ê²© & ë‰´ìŠ¤ ëŒ€ì‹œë³´ë“œ</p>
</header>

<section class="grid">

<!-- ì™¼ìª½: ê°€ê²©/ë‰´ìŠ¤ -->
<div class="card">
  <div class="hd">
    <div>
      <div class="k">Status</div>
      <strong id="statusText">Ready</strong>
    </div>
    <span class="pill" id="pill">STATIC</span>
  </div>
  <div class="bd">
    <div class="k">ê°€ê²©</div>
    <div id="prices"></div>

    <div style="height:16px"></div>

    <div class="k">ë‰´ìŠ¤</div>
    <div id="news"></div>
  </div>
</div>

<!-- ì˜¤ë¥¸ìª½: ê´€ë¦¬ -->
<div class="card">
  <div class="hd">
    <div class="k">ì¢…ëª© ê´€ë¦¬</div>
    <span class="pill">B ë°©ì‹</span>
  </div>
  <div class="bd">
    <div class="k">ë§ˆì§€ë§‰ í™•ì¸</div>
    <strong id="lastCheck">-</strong>

    <div style="height:14px"></div>

    <input id="symInput" placeholder="ì‹¬ë³¼ ì…ë ¥ (ì˜ˆ: TSLA, 005930.KS)">
    <div style="display:flex;gap:10px;margin-top:10px">
      <button class="btn" id="addBtn">â• ì¶”ê°€</button>
      <button class="btn" id="delBtn">â– ì‚­ì œ</button>
    </div>

    <p class="muted" style="font-size:12px;margin-top:8px">
      ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ GitHub Issueê°€ ì—´ë¦¬ê³ <br>
      ì œì¶œí•˜ë©´ ìë™ìœ¼ë¡œ watchlistê°€ ë°˜ì˜ë¨
    </p>
  </div>
</div>

</section>
</div>

<script>
/* ---------- repo url ìë™ ì¶”ë¡  ---------- */
let repoUrl=null;
try{
  const host=location.host;
  const p=location.pathname.split("/").filter(Boolean);
  if(host.endsWith("github.io")&&p.length){
    repoUrl=`https://github.com/${host.split(".")[0]}/${p[0]}`;
  }
}catch{}

/* ---------- allowed symbols ---------- */
let allowed=new Set();
fetch("./allowed_symbols.json?ts="+Date.now())
  .then(r=>r.ok?r.json():null)
  .then(d=>{
    if(d?.symbols) d.symbols.forEach(s=>allowed.add(String(s).toUpperCase()));
  });

/* ---------- dashboard ---------- */
function renderPrices(arr){
  if(!arr?.length){
    prices.innerHTML='<div class="muted">ê°€ê²© ë°ì´í„° ì—†ìŒ</div>';return;
  }
  prices.innerHTML=`
  <table class="table">
    <tr><th>ì¢…ëª©</th><th class="right">Close</th><th class="right">ì‹œê°„</th></tr>
    ${arr.map(p=>`
      <tr>
        <td>${p.symbol}</td>
        <td class="right">${p.close??"-"}</td>
        <td class="right muted">${[p.date,p.time].filter(Boolean).join(" ")}</td>
      </tr>`).join("")}
  </table>`;
}

function renderNews(groups){
  if(!groups?.length){news.innerHTML='<div class="muted">ë‰´ìŠ¤ ì—†ìŒ</div>';return;}
  const flat=[];
  groups.forEach(g=>(g.items||[]).forEach(i=>flat.push(i)));
  news.innerHTML=flat.slice(0,10).map(n=>`
    <div class="newsItem">
      <a href="${n.link}" target="_blank">${n.headline}</a>
      <div class="muted" style="font-size:12px">${n.source||""}</div>
    </div>`).join("");
}

async function loadData(){
  lastCheck.textContent=new Date().toLocaleString("ko-KR");
  statusText.textContent="Loading...";
  try{
    const r=await fetch("./data.json?ts="+Date.now());
    if(!r.ok) throw 1;
    const d=await r.json();
    renderPrices(d.prices);
    renderNews(d.news);
    statusText.textContent="Live";
    pill.textContent="AUTO";
  }catch{
    statusText.textContent="No data yet";
    pill.textContent="STATIC";
  }
}
loadData();

/* ---------- issue open ---------- */
function openIssue(action){
  const sym=symInput.value.trim().toUpperCase();
  if(!sym) return alert("ì‹¬ë³¼ ì…ë ¥í•´");
  if(allowed.size && !allowed.has(sym))
    return alert(`${sym} ëŠ” ì§€ì› ì•ˆ í•¨`);
  if(!repoUrl) return alert("ë ˆí¬ URL ëª» ì°¾ìŒ");
  const url=`${repoUrl}/issues/new?title=watchlist&body=${encodeURIComponent(
    `action:${action}\nsymbol:${sym}`)}`;
  window.open(url,"_blank");
}
addBtn.onclick=()=>openIssue("add");
delBtn.onclick=()=>openIssue("remove");
</script>
</body>
</html>